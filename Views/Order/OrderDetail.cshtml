@model EbayChat.Entities.OrderTable
@{
    ViewData["Title"] = "Order Detail";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var error = ViewBag.Error ?? TempData["ErrorMessage"];
    var success = ViewBag.Success ?? TempData["SuccessMessage"];
}
<style>
    body {
        background-color: #f7f7f7;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .success-header {
        background: linear-gradient(135deg, #3665f3 0%, #1e4db7 100%);
        color: white;
        padding: 40px 0;
        text-align: center;
    }

    .success-icon {
        font-size: 60px;
        margin-bottom: 20px;
        animation: scaleIn 0.5s ease-out;
    }
    @@keyframes scaleIn {
        from

    {
        transform: scale(0);
    }

    to {
        transform: scale(1);
    }

    }

    .order-card {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        margin-bottom: 20px;
        overflow: hidden;
    }

    .card-header-custom {
        background-color: #f5f5f5;
        border-bottom: 2px solid #e5e5e5;
        padding: 15px 20px;
        font-weight: 600;
    }

    .product-img {
        width: 100px;
        height: 100px;
        object-fit: cover;
        border-radius: 5px;
    }

    .info-row {
        padding: 12px 0;
        border-bottom: 1px solid #f0f0f0;
    }

        .info-row:last-child {
            border-bottom: none;
        }

    .label {
        color: #707070;
        font-size: 14px;
    }

    .value {
        color: #191919;
        font-weight: 500;
    }

    .total-section {
        background-color: #fafafa;
        padding: 20px;
        border-top: 2px solid #e5e5e5;
    }

    .total-amount {
        font-size: 24px;
        font-weight: bold;
        color: red;
    }

    .btn-ebay {
        background-color: #3665f3;
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 25px;
        font-weight: 600;
        transition: all 0.3s;
    }

        .btn-ebay:hover {
            background-color: #1e4db7;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(54, 101, 243, 0.3);
        }

    .status-badge {
        background-color: #28a745;
        color: white;
        padding: 6px 15px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 600;
    }
</style>

<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">eBay</a></li>
        <li class="breadcrumb-item">
            <a asp-controller="Order" asp-action="MyOrders">My orders</a>
        </li>
        <li class="breadcrumb-item active">
            <a asp-controller="Order" asp-action="OrderDetail" asp-route-id="@Model.id">Order #@Model.id</a>
        </li>
    </ol>
</nav>
@if (!string.IsNullOrEmpty(error))
{
    <div class="alert alert-danger">@error</div>
}
@if (!string.IsNullOrEmpty(success))
{
    <div class="alert alert-success">@success</div>
}

<div class="container my-5">
    <div class="row">
        <div class="col-lg-8">
            <div class="order-card">
                <div class="card-header-custom">
                    <i class="fas fa-receipt me-2"></i>Order Detail
                </div>
                <div class="p-4">
                    <div class="info-row d-flex justify-content-between">
                        <span class="label">Order ID:</span>
                        <span class="value">#@Model.id</span>
                    </div>
                    <div class="info-row d-flex justify-content-between">
                        <span class="label">Order Date:</span>
                        <span class="value">@Model.orderDate</span>
                    </div>
                    <div class="info-row d-flex justify-content-between align-items-center">
                        <span class="label">Status:</span>
                        <span class="status-badge">@Model.status</span>
                    </div>
                </div>
            </div>

            <!-- Sản phẩm -->
            <div class="order-card">
                <div class="card-header-custom">
                    <i class="fas fa-box me-2"></i>Order Item
                </div>
                @if(Model.OrderItems.Any()){
                    <div class="p-4">
                        @foreach (var orderItem in Model.OrderItems)
                        {
                            <div class="d-flex mb-4 pb-4 border-bottom">
                                <img src="@orderItem.product?.images"
                                     alt="Product" class="product-img me-3">
                                <div class="flex-grow-1">
                                    <h6 class="mb-2">@orderItem.product?.title</h6>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="text-muted">Quantity: @orderItem.quantity</span>
                                        <span class="fw-bold text-danger">$@(orderItem.unitPrice * orderItem.quantity)</span>
                                    </div>
                                </div>
                            </div>

                        }
                    </div>
                }
                else{
                    <h1 class="text-bg-danger">There is no order item here.</h1>
                }
            </div>

            <!-- Địa chỉ giao hàng -->
            <div class="order-card">
                <div class="card-header-custom">
                    <i class="fas fa-shipping-fast me-2"></i>Shipping info
                </div>
                <div class="p-4">
                    <h6 class="mb-3">@Model.address.fullName</h6>
                    <p class="mb-1"><i class="fas fa-phone text-muted me-2"></i>@Model.address.phone</p>
                    <p class="mb-0">
                        <i class="fas fa-map-marker-alt text-muted me-2"></i>
						@Model.address.street, @Model.address.city, @Model.address.state, @Model.address.country
                    </p>
                </div>
            </div>
        </div>

        <!-- Cột phải - Tóm tắt thanh toán -->
        <div class="col-lg-4">
            <div class="order-card position-sticky" style="top: 20px;">
                <div class="card-header-custom">
                    <i class="fas fa-file-invoice-dollar me-2"></i>Summary
                </div>
                <div class="p-4">
                    <div class="info-row d-flex justify-content-between">
                        <span class="label">Calculated:</span>
                        <span class="value">$@Model.totalPrice</span>
                    </div>
                    <div class="info-row d-flex justify-content-between">
                        <span class="label">Shipping fee:</span>
                        <span class="value">$0</span>
                    </div>
                </div>
                <div class="total-section">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span class="label">Total:</span>
                        <span class="total-amount">$@Model.totalPrice</span>
                    </div>
                    <div class="info-row d-flex justify-content-between">
                        <span class="label">Payment method:</span>
                        <span class="value"><i class="fab fa-cc-visa me-1"></i>Visa •••• 4532</span>
                    </div>
                </div>
                @if (Model.status == "Completed")
                {
                    <div class="mt-4 text-center mb-2">
                        <button class="btn btn-outline-danger me-2" data-bs-toggle="modal" data-bs-target="#returnModal">
                            <i class="fas fa-undo me-1"></i>Request Return
                        </button>
                        <button class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#disputeModal">
                            <i class="fas fa-exclamation-triangle me-1"></i>Raise Dispute
                        </button>
                    </div>
                }
            </div>

        </div>
    </div>
</div>
<!-- Return Request Modal -->
<div class="modal fade" id="returnModal" tabindex="-1" aria-labelledby="returnModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form asp-controller="Order" asp-action="SubmitReturnRequest" method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="returnModalLabel">Request a Return</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="orderId" value="@Model.id" />
                    <div class="mb-3">
                        <label class="form-label">Reason for Return</label>
                        <textarea name="reason" class="form-control" rows="3" placeholder="Describe why you want to return this order..." required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Submit Request</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Dispute Modal -->
<div class="modal fade" id="disputeModal" tabindex="-1" aria-labelledby="disputeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form asp-controller="Order" asp-action="SubmitDispute" method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="disputeModalLabel">Raise a Dispute</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="orderId" value="@Model.id" />
                    <div class="mb-3">
                        <label class="form-label">Describe your issue</label>
                        <textarea name="description" class="form-control" rows="3" placeholder="What went wrong with this order?" required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-warning">Submit Dispute</button>
                </div>
            </form>
        </div>
    </div>
</div>
